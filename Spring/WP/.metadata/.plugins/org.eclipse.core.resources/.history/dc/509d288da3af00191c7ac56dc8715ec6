package com.hsbc.dao.impl;

import java.sql.Connection;
import java.sql.DatabaseMetaData;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import com.hsbc.daos.EmployeesDao;
import com.hsbc.models.Employees;



public class EmployeeDaoImpl implements EmployeesDao {
private final static String conURL="jdbc:derby:C:\\Work\\HSBC\\Derby\\EmployeeDB;create=true";
	
	private Connection conn=null;
	public EmployeeDaoImpl(){
	try {
		Class.forName("org.apache.derby.jdbc.EmbeddedDriver");
		System.out.println("++DEb driver loaded");
	}catch(ClassNotFoundException e) {
		e.printStackTrace();
	}
	}
	@Override
		public void createConnection() {
			// TODO Auto-generated method stub
			try{
				conn =DriverManager.getConnection(conURL);
				System.out.println("++++ Conected to DB");
				DatabaseMetaData dmd  =conn.getMetaData();
				System.out.println(dmd.getDatabaseProductName());
			}catch(SQLException e) {
				e.printStackTrace();
			}
			}

	@Override
	public void addEmployee(Employees employee) {
		String sql = "insert into employee values("+employee.getEmployeeId()+",'"+
				employee.getEmployeeName()+"',"+employee.getAddress()+",'"+
						employee.getSalary()+"',"+employee.getContactNum()+",'"+employee.getDept()+"')";
				createConnection();
				try {
					Statement stmt = conn.createStatement();
					System.out.println("++++ Statement Created");
					int cnt = stmt.executeUpdate(sql);
					if(cnt!=0) {
						System.out.println("++++ Inserted "+employee+" To Table +++");
						
					}
				}catch(SQLException e) {
					e.printStackTrace();
				}finally {
					closeConnection();
				}
	}

	@Override
	public Employees getEmployee(int employeeId) {
		Employees employee = null;
		String sql = "select * from employee where employeeID = "+employeeId;
		createConnection();
		try {
			Statement stmt = conn.createStatement();
			ResultSet  rs = stmt.executeQuery(sql);
			if(rs.next()) {
				employee = new Employees(rs.getInt("employeeId"),rs.getString("employeename"),rs.getInt("salary"),rs.getString("address")
						,rs.getInt("contactnum"),rs.getString("dept"));
				
			}
		}catch(SQLException e) {
			e.printStackTrace();
		}finally {
			closeConnection();
		}
		return employee;
	}
	

	@Override
	public void closeConnection() {
		if(conn!=null) {
			try {
				//DriverManager.getConnection(conURL+";shutdown=true");
				conn.close();
				System.out.println("+++ db conection closed+++");
				
			}catch(SQLException e) {
				e.printStackTrace();
			}
		}
	}

}
